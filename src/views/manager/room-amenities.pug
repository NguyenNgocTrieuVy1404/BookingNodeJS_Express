extends ../layoutManager

block content
    .container-fluid.p-4
        #notificationContainer.position-fixed.top-0.end-0.p-3(style="z-index: 1060; max-width: 380px;")
            // Thông báo sẽ được thêm vào đây bằng JavaScript
            
        .card.shadow-sm
            .card-header.bg-white.py-3.d-flex.justify-content-between.align-items-center
                h5.card-title.mb-0
                    i.fas.fa-concierge-bell.me-2.text-primary
                    | Quản lý Tiện nghi - Phòng #{room.idPhong}
                a.btn.btn-outline-secondary.btn-sm(href="/manager/rooms")
                    i.fas.fa-arrow-left.me-1
                    | Quay lại danh sách phòng

            .card-body
                .row.mb-4
                    .col-md-6
                        .card.border-0.bg-light
                            .card-body
                                h6.card-title.fw-bold Thông tin phòng
                                p.mb-1
                                    strong Khách sạn: 
                                    span #{room.tenKhachSan}
                                p.mb-1
                                    strong Loại phòng: 
                                    span #{room.tenLoaiPhong}
                                p.mb-1
                                    strong Giá phòng: 
                                    span #{room.giaPhong.toLocaleString('vi-VN')} đ

                .row.mb-4
                    .col-12
                        h6.fw-bold.mb-3 Tiện nghi hiện có
                        if roomAmenities && roomAmenities.length > 0
                            .row
                                each amenity in roomAmenities
                                    .col-md-3.col-sm-6.mb-3
                                        .card.border-0.shadow-sm
                                            .card-body.d-flex.justify-content-between.align-items-center
                                                div
                                                    i.fas.fa-check-circle.text-success.me-2
                                                    span #{amenity.tenTienNghi}
                                                button.btn.btn-sm.btn-outline-danger(onclick=`removeAmenity(${room.idPhong}, ${amenity.idTienNghi})`)
                                                    i.fas.fa-times
                        else
                            .alert.alert-info
                                i.fas.fa-info-circle.me-2
                                | Phòng này chưa có tiện nghi nào

                .row
                    .col-12
                        h6.fw-bold.mb-3 Thêm tiện nghi
                        if availableAmenities && availableAmenities.length > 0
                            form(method="POST" action="/manager/rooms/amenities/add")
                                input(type="hidden" name="idPhong" value=room.idPhong)
                                .row
                                    .col-md-8
                                        select.form-select#idTienNghi(name="idTienNghi" required)
                                            option(value="" selected disabled) -- Chọn tiện nghi --
                                            each amenity in availableAmenities
                                                option(value=amenity.idTienNghi) #{amenity.tenTienNghi}
                                    .col-md-4
                                        button.btn.btn-primary.w-100(type="submit")
                                            i.fas.fa-plus.me-2
                                            | Thêm tiện nghi
                        else
                            .alert.alert-info
                                i.fas.fa-info-circle.me-2
                                | Không có tiện nghi nào có thể thêm

block scripts
    style.
        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        @keyframes slideOutRight {
            from {
                transform: translateX(0);
                opacity: 1;
            }
            to {
                transform: translateX(100%);
                opacity: 0;
            }
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); }
            70% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        @keyframes progress {
            from { width: 100%; }
            to { width: 0%; }
        }
        
        .custom-toast {
            position: relative;
            opacity: 1;
            background: #fff;
            margin-bottom: 16px;
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            align-items: stretch;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.15), 0 5px 10px -5px rgba(0,0,0,0.1);
            animation: slideInRight 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
            max-width: 100%;
            transform-origin: right center;
            backdrop-filter: blur(10px);
        }
        
        .custom-toast.closing {
            animation: slideOutRight 0.5s cubic-bezier(0.55, 0.085, 0.68, 0.53) forwards;
        }
        
        .toast-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            font-size: 26px;
            padding: 0 5px;
            animation: pulse 0.6s ease-in-out;
        }
        
        .toast-content {
            flex-grow: 1;
            padding: 16px 15px;
            position: relative;
        }
        
        .toast-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 6px;
            letter-spacing: 0.2px;
        }
        
        .toast-message {
            font-size: 14px;
            opacity: 0.85;
            line-height: 1.5;
            margin-right: 20px;
        }
        
        .toast-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background: transparent;
            border: none;
            font-size: 18px;
            width: 24px;
            height: 24px;
            line-height: 1;
            cursor: pointer;
            opacity: 0.6;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            padding: 0;
        }
        
        .toast-close:hover {
            opacity: 1;
            background: rgba(0,0,0,0.05);
            transform: rotate(90deg);
        }
        
        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            width: 100%;
            background: rgba(255,255,255,0.4);
        }
        
        .toast-progress-bar {
            height: 100%;
            width: 100%;
        }
        
        /* Gradient backgrounds for different types */
        .toast-success {
            border-left: none;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
        }
        
        .toast-success .toast-icon {
            background: linear-gradient(145deg, #28a745, #218838);
            color: white;
        }
        
        .toast-success .toast-progress-bar {
            background: linear-gradient(90deg, #28a745, #5cb85c);
            animation: progress 5s linear forwards;
        }
        
        .toast-error {
            border-left: none;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
        }
        
        .toast-error .toast-icon {
            background: linear-gradient(145deg, #dc3545, #c82333);
            color: white;
        }
        
        .toast-error .toast-progress-bar {
            background: linear-gradient(90deg, #dc3545, #f55a4e);
            animation: progress 5s linear forwards;
        }
        
        .toast-warning {
            border-left: none;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
        }
        
        .toast-warning .toast-icon {
            background: linear-gradient(145deg, #ffc107, #e0a800);
            color: #212529;
        }
        
        .toast-warning .toast-progress-bar {
            background: linear-gradient(90deg, #ffc107, #ffdb4a);
            animation: progress 5s linear forwards;
        }
        
        .toast-info {
            border-left: none;
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
        }
        
        .toast-info .toast-icon {
            background: linear-gradient(145deg, #17a2b8, #138496);
            color: white;
        }
        
        .toast-info .toast-progress-bar {
            background: linear-gradient(90deg, #17a2b8, #4fbcce);
            animation: progress 5s linear forwards;
        }
    
    script.
        function removeAmenity(idPhong, idTienNghi) {
            if (confirm('Bạn có chắc muốn xóa tiện nghi này khỏi phòng?')) {
                window.location.href = `/manager/rooms/amenities/remove/${idPhong}/${idTienNghi}`;
            }
        }
        
        // Hệ thống thông báo
        class NotificationSystem {
            constructor() {
                this.container = document.getElementById('notificationContainer');
                this.counter = 0;
                this.notifications = {};
            }
            
            // Hiển thị thông báo
            show(message, options = {}) {
                const { 
                    type = 'success', 
                    title = this._getDefaultTitle(type),
                    icon = this._getDefaultIcon(type),
                    duration = 5000 
                } = options;
                
                const id = `toast-${++this.counter}`;
                
                // Tạo toast element
                const toast = document.createElement('div');
                toast.className = `custom-toast toast-${type}`;
                toast.id = id;
                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="toast-content">
                        <div class="toast-title">${title}</div>
                        <div class="toast-message">${message}</div>
                        <button type="button" class="toast-close" aria-label="Đóng">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="toast-progress">
                            <div class="toast-progress-bar"></div>
                        </div>
                    </div>
                `;
                
                // Thêm vào container
                this.container.appendChild(toast);
                
                // Lưu tham chiếu để có thể hủy nếu cần
                this.notifications[id] = {
                    element: toast,
                    timeout: null
                };
                
                // Thêm sự kiện click cho nút đóng
                const closeBtn = toast.querySelector('.toast-close');
                closeBtn.addEventListener('click', () => {
                    this._hideToast(id);
                });
                
                // Tự động ẩn sau duration
                if (duration > 0) {
                    // Cài đặt thời gian đóng thông báo
                    this.notifications[id].timeout = setTimeout(() => {
                        this._hideToast(id);
                    }, duration);
                    
                    // Cập nhật thời gian của progress bar
                    const progressBar = toast.querySelector('.toast-progress-bar');
                    progressBar.style.animationDuration = `${duration}ms`;
                }
                
                return id;
            }
            
            // Ẩn thông báo
            _hideToast(id) {
                const notification = this.notifications[id];
                if (!notification) return;
                
                const { element, timeout } = notification;
                
                // Xóa timeout nếu có
                if (timeout) {
                    clearTimeout(timeout);
                }
                
                // Thêm class closing để bắt đầu animation ẩn
                element.classList.add('closing');
                
                // Xóa sau khi animation hoàn thành
                setTimeout(() => {
                    if (element.parentNode) {
                        element.parentNode.removeChild(element);
                    }
                    delete this.notifications[id];
                }, 500); // Thời gian bằng với thời gian của animation slideOutRight
            }
            
            // Ẩn tất cả thông báo
            hideAll() {
                Object.keys(this.notifications).forEach(id => {
                    this._hideToast(id);
                });
            }
            
            // Lấy tiêu đề mặc định theo loại
            _getDefaultTitle(type) {
                switch(type) {
                    case 'success': return 'Thành công!';
                    case 'error': return 'Lỗi!';
                    case 'warning': return 'Cảnh báo!';
                    case 'info': return 'Thông tin';
                    default: return 'Thông báo';
                }
            }
            
            // Lấy icon mặc định theo loại
            _getDefaultIcon(type) {
                switch(type) {
                    case 'success': return 'fas fa-check-circle';
                    case 'error': return 'fas fa-times-circle';
                    case 'warning': return 'fas fa-exclamation-triangle';
                    case 'info': return 'fas fa-info-circle';
                    default: return 'fas fa-bell';
                }
            }
            
            // Hiển thị thông báo thành công
            success(message, options = {}) {
                return this.show(message, { ...options, type: 'success' });
            }
            
            // Hiển thị thông báo lỗi
            error(message, options = {}) {
                return this.show(message, { ...options, type: 'error' });
            }
            
            // Hiển thị cảnh báo
            warning(message, options = {}) {
                return this.show(message, { ...options, type: 'warning' });
            }
            
            // Hiển thị thông tin
            info(message, options = {}) {
                return this.show(message, { ...options, type: 'info' });
            }
        }

        // Khởi tạo hệ thống thông báo
        const notifications = new NotificationSystem();

        // Hiển thị thông báo từ cookie
        document.addEventListener('DOMContentLoaded', function() {
            const getCookie = (name) => {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
            };
            
            const managerMessage = getCookie('managerMessage');
            const managerError = getCookie('managerError');
            
            // Hiển thị thông báo thành công
            if (managerMessage) {
                notifications.success(decodeURIComponent(managerMessage));
                document.cookie = 'managerMessage=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            }
            
            // Hiển thị thông báo lỗi
            if (managerError) {
                notifications.error(decodeURIComponent(managerError));
                document.cookie = 'managerError=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            }
        }); 